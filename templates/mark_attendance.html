{% extends "base.html" %}

{% block title %}Mark Attendance{% endblock %}
{% block page_title %}Attendance Management{% endblock %}

{% block content %}
<div class="container-fluid">

  <!-- HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h5 class="fw-semibold mb-0">
      <i class="fa-solid fa-calendar-check me-2 text-success"></i>Mark Attendance
    </h5>
    <a href="{{ url_for('manager_bp.manager_dashboard') }}" class="btn btn-outline-secondary">
      <i class="fa-solid fa-arrow-left"></i> Back
    </a>
  </div>

  <!-- DATE FILTER -->
  <form method="get" class="mb-4 d-flex flex-wrap gap-2 align-items-center">
    <input type="date"
           name="date"
           class="form-control"
           style="max-width:220px"
           value="{{ selected_date }}"
           max="{{ today }}"
           required>
    <button class="btn btn-primary">
      <i class="fa-solid fa-search"></i> Load
    </button>
  </form>

  <!-- ATTENDANCE GRID -->
  <form method="post">
    <input type="hidden" name="date" value="{{ selected_date }}">

    <div class="table-responsive">
      <table class="table table-bordered align-middle">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Labour</th>
            <th>Day Shift</th>
            <th>Night Shift</th>
            
          </tr>
        </thead>
        <tbody>
          {% for labour in labours %}
          {% set att = attendance_map.get(labour.id) %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ labour.name }}</td>

            <td>
              <select name="day_shift_{{ labour.id }}" class="form-select">
                <option value="0" {% if att and not att.day_shift_flag %}selected{% endif %}>❌ Absent</option>
                <option value="1" {% if att and att.day_shift_flag %}selected{% endif %}>✅ Present</option>
              </select>
            </td>

            <td>
              <select name="night_shift_{{ labour.id }}" class="form-select">
                <option value="0" {% if att and not att.night_shift_flag %}selected{% endif %}>❌ Absent</option>
                <option value="1" {% if att and att.night_shift_flag %}selected{% endif %}>✅ Present</option>
              </select>
            </td>


          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <button class="btn btn-success mt-3">
      <i class="fa-solid fa-floppy-disk"></i> Save Attendance
    </button>
  </form>

</div>
{% endblock %}
