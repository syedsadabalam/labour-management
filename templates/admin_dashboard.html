{% extends "base.html" %}
{% block content %}
<div class="container-fluid mt-4">

<!-- HEADER -->
<div class="d-flex justify-content-between align-items-start mb-4">
  <div>
    <h2 class="mb-1">Welcome back, {{ current_user.username }} ðŸ‘‹</h2>
    <p class="text-muted">System overview & operational health</p>
  </div>
  <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-danger">Logout</a>
</div>

<!-- PRIMARY STATS -->
<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="stat-card p-3">
      <div class="stat-title">Total Labour</div>
      <div class="stat-value">{{ total_labours }}</div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stat-card p-3">
      <div class="stat-title">Managers</div>
      <div class="stat-value">{{ total_managers }}</div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stat-card p-3">
      <div class="stat-title">Sites</div>
      <div class="stat-value">{{ total_sites }}</div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stat-card p-3">
      <div class="stat-title">Attendance Today</div>
      <div class="stat-value">{{ today_present }} / {{ total_labours }}</div>
    </div>
  </div>
</div>

<!-- FINANCIAL SUMMARY -->
<div class="row g-3 mb-4">
  <div class="col-md-6">
    <div class="card p-3">
      <div class="text-muted">Total Payable</div>
      <div class="fs-3 fw-bold">â‚¹{{ "%.2f"|format(total_payable_amount) }}</div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card p-3">
      <div class="text-muted">Total Advances</div>
      <div class="fs-3 fw-bold text-danger">â‚¹{{ "%.2f"|format(total_advance) }}</div>
    </div>
  </div>
</div>

<!-- QUICK ACTIONS -->
<div class="card mb-4">
  <div class="card-body d-flex flex-wrap gap-2">
    <a href="{{ url_for('admin_bp.admin_sites') }}" class="btn btn-outline-primary">Sites</a>
    <a href="{{ url_for('admin_bp.admin_managers') }}" class="btn btn-outline-success">Managers</a>
    <a href="{{ url_for('admin_bp.monthly_report') }}" class="btn btn-outline-info">Monthly Reports</a>
    <a href="{{ url_for('admin_bp.attendance_report') }}" class="btn btn-outline-secondary">Attendance Report</a>
    <a href="{{ url_for('admin_bp.labour_salary_sheet') }}" class="btn btn-outline-success">Salary Sheet</a>
    <a href="{{ url_for('admin_bp.admin_audit_logs') }}" class="btn btn-outline-dark">Activity Logs</a>
  </div>
</div>

<!-- MANAGER ACTIVITY -->
<div class="card rounded-lg mb-4">
  <div class="card-body">
    <h5 class="mb-3">Site Attendance Activity (Today)</h5>

    <table class="table table-sm align-middle">
      <thead>
        <tr>
          <th>Site</th>
          <th>Last Attendance</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for a in site_activity %}
        <tr>
          <td>{{ a.site_name }}</td>
          <td>{{ a.last_attendance or '-' }}</td>
          <td>
            {% if a.status == 'Active' %}
              <span class="badge bg-success">Active</span>
            {% elif a.status == 'Delayed' %}
              <span class="badge bg-warning text-dark">Delayed</span>
            {% else %}
              <span class="badge bg-danger">Inactive</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>


<!-- TOP LABOURS -->
<div class="card mb-5">
  <div class="card-body">
    <h5>Top Labours by Presence</h5>
    {% if top_labours %}
      {% for l in top_labours %}
        <div class="d-flex justify-content-between border-bottom py-2">
          <strong>{{ l.name }}</strong>
          <span>{{ l.days_present }} shifts</span>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-muted">No attendance data</p>
    {% endif %}
  </div>
</div>

</div>
{% endblock %}
